<!-- filepath: /c:/Users/samue/Desktop/projects/bounceback/templates/profile/edit_profile.html -->
{% extends "base_generic.html" %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
  <div class="header bg-primary py-3">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center">
          <div class="col-lg-6 col-7">
            <h6 class="h2 text-white d-inline-block mb-0"><i class="fa-solid fa-address-card"></i> Edit Profile</h6>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid mt-4">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header border-0">
            <h3 class="mb-0">Edit Profile</h3>
          </div>
          <div class="card-body">
            <form method="post">
              {% csrf_token %}
              {{ user_form.as_p }}
              <div class="form-group">
                <label for="signature">Signature</label>
                <canvas id="signature-pad" class="signature-pad" width="400" height="200" style="border: 1px solid #808080; border-radius: 10px;"></canvas>
                <input type="hidden" name="signature" id="signature">
                <input type="hidden" name="clear_signature" id="clear_signature" value="false">
                {% if profile.signature %}
                  <p>Saved Signature:</p>
                  <img src="{{ profile.signature }}" alt="Saved Signature" style="border: 1px solid #808080; border-radius: 10px;">
                {% endif %}
              </div>
              <button type="submit" class="btn btn-primary" onclick="saveSignature()">Save changes</button>
              <button type="button" class="btn btn-secondary" onclick="clearSignature()">Clear Signature</button>
              <button type="button" class="btn bg-gradient-danger" onclick="showDisclaimer()">Disclaimer</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="disclaimerModal" tabindex="-1" role="dialog" aria-labelledby="disclaimerModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="disclaimerModalLabel">Disclaimer</h5>
        </div>
        <div class="modal-body">
          I declare that the information I have given on this application and forms are correct and complete
          and that I have not claimed elsewhere for the hours/shifts on this application. I
          understand that if I knowingly provide false information this may result in
          disciplinary action and I may be liable to prosecution and civil recovery
          proceedings. I consent to this disclosure of information from this application and form to and
          by any Bounce Back Healthcare Solutions authorized body for the purpose of verification of this claim and the investigation, detection and prosecution of fraud.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn bg-gradient-primary" onclick="dismissDisclaimer()">OK</button>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block extra_js %}
  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Include Signature Pad JS -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script>
    var canvas = document.getElementById('signature-pad');
    var signaturePad = new SignaturePad(canvas);

    function saveSignature() {
        if (!signaturePad.isEmpty()) {
            var dataUrl = signaturePad.toDataURL();
            document.getElementById('signature').value = dataUrl;
        } else {
            var existingSignature = document.querySelector('img[alt="Saved Signature"]');
            if (existingSignature) {
                document.getElementById('signature').value = existingSignature.src;
            }
        }
    }

    function showDisclaimer() {
        $('#disclaimerModal').modal('show');
    }

    function dismissDisclaimer() {
        $('#disclaimerModal').modal('hide');
    }

    function clearSignature() {
        signaturePad.clear();
        document.getElementById('signature').value = '';
        document.getElementById('clear_signature').value = 'true';
    }
  </script>
{% endblock %}